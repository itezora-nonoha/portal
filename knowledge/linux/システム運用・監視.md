
## システムメンテナンス

### 定期実行

#### cron
- `crontab -e`で設定ファイルの編集画面に入れる
- crontabの設定ファイル
  - システムの設定ファイルは`/etc/crontab`であり、フィールドは7つ
  - ユーザの設定ファイルは`/var/spool/cron/user_name`であり、フィールドは6つ

##### 使用制御
- `/etc/cron.allow`および`/etc/cron.deny`

#### at
- 時刻を指定し、1回だけコマンドを実行する

|操作|コマンド|
|-|-|
|キュー内のジョブを表示する|at -l または　atq|
|ジョブの内容を表示する|at -c または atc|
|ジョブを削除する|at -d または at -r または atrm|

##### 使用制御
- `/etc/at.allow`および`/etc/at.deny`

#### batch
- システムの負荷が低くなった時に1回だけコマンドを実行する

##### 使用制御
- `/etc/at.allow`および`/etc/at.deny`

#### systemdのタイマー

##### monotonic timer
- 指定した間隔で一回または複数回、サービスを実行する

```
[Timer]
OnActiveSec=1hour # タイマーをアクティベートしてから実行するまでの待機時間
OnUnitActiveSec=1hour # 繰り返し実行する時間間隔
Unit=timer-test.service # 対象とするサービス
```

##### realtime timer
- 指定した時刻にサービスを実行する   

```
[Timer]
OnCalender=*-*-* 4:00:00 # 実行する時刻
Unit=timer-test.service # 対象とするサービス
```




### ランレベル

|ランレベル|systemdのターゲットサービス|説明|内容|
|-|-|-|-|
|0|-|停止|システムの停止|
|1|rescue.target|シングルユーザ|rootだけログイン可能（システムメンテナンスで使用される）|
|3|multi-user.target|マルチユーザ|rootだけでなく一般ユーザもログイン可能。<br>コンソールに表示されたログインプロンプトからログインする|
|5|graphical.target|マルチユーザ＋GUI画面|ディスプレイマネージャのログイン画面からX Window Systemにログインする|
|6|-|再起動|システムの再起動|

> システム起動後のデフォルトのランレベルは`/etc/inittab`で定義できる

|コマンド|説明|
|-|-|
|init ランレベル|ランレベルを変更する|
|telinit ランレベル|ランレベルを変更する|
|telinit q|`/etc/inittab`ファイルを変更後、即時にinitプロセスに反映させるために実行するコマンド|
|runlevel|現在のランレベルを確認する|
|who -r|現在のランレベルを確認する|

#### systemdのデフォルトターゲットの取得
- `systemctl get-default`

#### systemdのデフォルトターゲットの設定
- `systemctl set-default multi-uesr.target`

|コマンド|説明|
|-|-|
|wall [メッセージ]|全員の端末にメッセージを送る|
|shutdown [オプション] 猶予時間 [メッセージ]|システムの停止や再起動を行う|
|hwclock|ハードウェアクロックとシステムクロックを調整する|
|ntpdate [オプション] NTPサーバのアドレス|NTPを使用してシステム時計を設定する（-qオプションをつけると、問い合わせのみを行う）|


### 時刻設定

|コマンド|説明|
|-|-|
|ntpdate|NTPを使用してシステムクロックを設定する
|hwclock|システムクロックとハードウェアクロックの同期を行う

#### hwclockコマンド

- ハードウェアクロックをシステムクロックに合わせる（システムクロックを基準にして調整する）

```sh
hwclock --systohc
```

|オプション|説明|
|-|-|
|-u|UTCとする|
|--systohc, -w|ハードウェアクロックをシステムクロックに合わせる|
|--hctosys, -s|システムクロックをハードウェアクロックに合わせる|


## システム監視

|コマンド|説明|
|-|-|
|uptime|現在時刻、システム起動からの時間、システム上にいるユーザ数、システムの平均負荷を順に表示|
|w|ログインしている人とその人がしていることを表示。ヘッダには`uptime`と同じ内容が表示される|
|top|プロセスの情報を周期的にリアルタイムで表示する。1行目には`uptime`と同じ内容が表示される|
|watch|指定されたコマンドを繰り返し実行する|

### unameコマンド

- マシンアーキテクチャやカーネルバージョンなどのシステム情報を表示する

``` sh
uname [オプション]
```

|コマンド|説明|
|-|-|
|-m|マシン（ハードウェア）のタイプを表示する）
|-n|マシンのネットワークホスト名を表示する
|-r|OSのリリースを表示する
|-s|OSの名称を表示する
|-v|OSのバージョンを表示する
|-a|情報全てを表示する
